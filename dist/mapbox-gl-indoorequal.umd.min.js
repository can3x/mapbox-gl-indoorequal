!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).IndoorEqual=t()}(this,(function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function r(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function o(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?r(Object(i),!0).forEach((function(t){n(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):r(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function l(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return a(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function s(e,t,i){var n,r,o,l,a;function s(){var u=Date.now()-l;u<t&&u>=0?n=setTimeout(s,t-u):(n=null,i||(a=e.apply(o,r),o=r=null))}null==t&&(t=100);var u=function(){o=this,r=arguments,l=Date.now();var u=i&&!n;return n||(n=setTimeout(s,t)),u&&(a=e.apply(o,r),o=r=null),a};return u.clear=function(){n&&(clearTimeout(n),n=null)},u.flush=function(){n&&(a=e.apply(o,r),o=r=null,clearTimeout(n),n=null)},u}s.debounce=s;var u=s;var c=function(){function t(i){var n=this;e(this,t),this.indoorequal=i,this._cbRefresh=function(){return n._refresh()},this.indoorequal.on("levelschange",this._cbRefresh),this.indoorequal.on("levelchange",this._cbRefresh),this.$el=document.createElement("div"),this.$el.classList.add("mapboxgl-ctrl","mapboxgl-ctrl-group","mapboxgl-ctrl-indoorequal"),this._refresh()}return i(t,[{key:"destroy",value:function(){this.$el.remove(),this.indoorequal.off("levelschange",this._cbRefresh),this.indoorequal.off("levelchange",this._cbRefresh)}},{key:"_refresh",value:function(){var e=this;if(this.$el.innerHTML="",1!==this.indoorequal.levels.length)this.indoorequal.levels.map((function(t){var i=document.createElement("button"),n=document.createElement("strong");n.textContent=t,i.appendChild(n),t==e.indoorequal.level&&i.classList.add("mapboxgl-ctrl-active"),i.addEventListener("click",(function(){e.indoorequal.updateLevel(t)})),e.$el.appendChild(i)}))}}]),t}(),f={type:"symbol","source-layer":"poi",layout:{"icon-image":"{class}_11","text-anchor":"top","text-field":"{name:latin}\n{name:nonlatin}","text-font":["Noto Sans Regular"],"text-max-width":9,"text-offset":[0,.6],"text-padding":2,"text-size":12},paint:{"text-color":"#666","text-halo-blur":.5,"text-halo-color":"#ffffff","text-halo-width":1}},h=["waste_basket","information"],d=[{id:"indoor-polygon",type:"fill","source-layer":"area",filter:["all",["==","$type","Polygon"],["!=","class","level"]],layout:{visibility:"visible"},paint:{"fill-color":"white"}},{id:"indoor-area",type:"line","source-layer":"area",filter:["all",["in","class","area","corridor","platform"]],layout:{visibility:"visible"},paint:{"line-color":"#bfbfbf","line-width":1}},{id:"indoor-column",type:"fill","source-layer":"area",filter:["all",["==","class","column"]],layout:{visibility:"visible"},paint:{"fill-color":"#bfbfbf"}},{id:"indoor-lines",type:"line","source-layer":"area",filter:["all",["in","class","room","wall"]],layout:{visibility:"visible"},paint:{"line-color":"gray","line-width":2}},{id:"indoor-transportation",type:"line","source-layer":"transportation",filter:["all"],layout:{visibility:"visible"},paint:{"line-color":"gray","line-dasharray":[.4,.75],"line-width":{base:1.4,stops:[[17,2],[20,10]]}}},o(o({id:"indoor-poi-rank1"},f),{},{filter:["all",["==","$type","Point"],["!in","class"].concat(h)]}),o(o({id:"indoor-poi-rank2"},f),{},{minzoom:19,filter:["all",["==","$type","Point"],["in","class"].concat(h)]}),o(o({id:"indoor-poi-vending"},f),{},{minzoom:19,filter:["all",["==","$type","Point"],["==","class","vending_machine"]],layout:o(o({},f.layout),{},{"icon-image":"{subclass}_11"})}),{id:"indoor-name",type:"symbol","source-layer":"area_name",filter:["all"],layout:{"text-field":["get","name"],"text-font":["Noto Sans Regular"],"text-max-width":5,"text-size":14},paint:{"text-color":"#666","text-halo-color":"#ffffff","text-halo-width":1}}];return function(){function t(i){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e(this,t);var r={url:"https://tiles.indoorequal.org/"},l=o(o({},r),n);if(l.url===r.url&&!l.apiKey)throw"You must register your apiKey at https://indoorequal.com before and set it as apiKey param.";this.map=i,this.url=l.url,this.apiKey=l.apiKey,this.levels=[],this.level="0",this.events={},this.map.isStyleLoaded()?this._addSource():this.map.on("load",this._addSource.bind(this))}return i(t,[{key:"on",value:function(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)}},{key:"off",value:function(e,t){this.events[e]||(this.events[e]=[]),this.events[e]=this.events[e].filter((function(e){return e!==t}))}},{key:"onAdd",value:function(){return this._control=new c(this),this._control.$el}},{key:"onRemove",value:function(){this._control.destroy(),this._control=null}},{key:"updateLevel",value:function(e){this.level=e,this._updateFilters(),this._emitLevelChange()}},{key:"_addSource",value:function(){var e=this,t=this.apiKey?"?key=".concat(this.apiKey):"";this.map.addSource("indoorequal",{type:"vector",url:"".concat(this.url).concat(t)}),d.forEach((function(t){e.map.addLayer(o({source:"indoorequal"},t))})),this._updateFilters();var i=u(this._updateLevels.bind(this),1e3);this.map.on("load",i),this.map.on("data",i),this.map.on("move",i)}},{key:"_updateFilters",value:function(){var e=this;d.forEach((function(t){e.map.setFilter(t.id,[].concat(l(t.filter),[["==","level",e.level]]))}))}},{key:"_refreshAfterLevelsUpdate",value:function(){this.levels.includes(this.level)||this.updateLevel("0")}},{key:"_updateLevels",value:function(){if(this.map.isSourceLoaded("indoorequal")){var e=function(e){for(var t=[],i=0;i<e.length;i++){var n=e[i].properties.level;t.includes(n)||t.push(n)}return t.sort((function(e,t){return e-t})).reverse()}(this.map.querySourceFeatures("indoorequal",{sourceLayer:"area"}));(function(e,t){var i=e.length;if(i!==t.length)return!1;for(var n=0;n<i;n++)if(e[n]!==t[n])return!1;return!0})(e,this.levels)||(this.levels=e,this._emitLevelsChange(),this._refreshAfterLevelsUpdate())}}},{key:"_emitLevelsChange",value:function(){this._emitEvent("levelschange",this.levels)}},{key:"_emitLevelChange",value:function(){this._emitEvent("levelchange",this.level)}},{key:"_emitEvent",value:function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];(this.events[e]||[]).forEach((function(e){return e.apply(void 0,i)}))}}]),t}()}));
